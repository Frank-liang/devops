# 分级发布

## 定义
将一次线上变更过程按照操作的服务实例分为若干个阶段，在每个阶段引入自动化的检查case，希望在更早的阶段发现问题，避免影响面扩散。 分级发布不局限于『程序、数据』变更，适用于所有的线上写操作。分级发布不是裁剪或者弱化线下测试步骤，不能取代线下的测试。

## 作用
- 在线上变更过程中，尽早发现问题并拦截，避免扩散到更多实例。
![](/images/stageusage.png)
<hr/>
- 在整个异常拦截体系中处于承上启下的作用。
![](/images/stageplace.png)

## 分级发布四要素
### 变更顺序
- 单次变更按可用性隔离域依次进行
- 多个变更顺序要保持一致：比如 A 模块按照 jx->tc，那么 B 模块也要按照 jx->tc，避免 A、B 分别把 jx、tc 上挂的情况

### 变更检查
- 调用服务 SLA 监控实施自动检查。


### 变更干预
- 支持一键暂停/恢复/撤销单个变更单
- 支持一键暂停/恢复/撤销多个变更单
- 可封禁上线窗口，确保故障解除之前不会引入新的变更风险

### 变更止损
- 可一键发起并快速（快于常规发布）实施回滚
- 一键顺序回滚：无需人工找版本，点击按钮即可回滚。回滚也要做分级发布，损速度，但稳妥
- 一键逆序回滚：最后做的最先回滚，速度快，不稳妥
- 自定义顺序回滚：哪个机房有问题就滚哪个，很灵活，针对性强
