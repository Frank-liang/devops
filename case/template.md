# 故障记录规范

## case study 基本信息

<table class="confluenceTable"><tbody><tr><td class="confluenceTd">会议时间</td><td class="confluenceTd">填写case study的会议时间</td></tr><tr><td class="confluenceTd">参与人</td><td class="confluenceTd"><span>填写</span>参与case study的同学</td></tr><tr><td class="confluenceTd">报告人</td><td class="confluenceTd"><span>填写</span>case study报告编写人</td></tr><tr><td colspan="1" class="confluenceTd">icafe故障单</td><td colspan="1" class="confluenceTd"><span>填写</span>与该故障关联的icafe单</td></tr><tr><td class="confluenceTd">故障级别</td><td class="confluenceTd"><p>参照公司事故定级标准，<span>填写</span>确定的故障级别</p></td></tr><tr><td class="confluenceTd">是否对用户产生影响</td><td class="confluenceTd">填写是或否</td></tr><tr><td class="confluenceTd">故障发现方式</td><td class="confluenceTd"><p>填写故障是通过什么方式发现的，比如：监控，人工保障等。</p></td></tr><tr><td class="confluenceTd">受影响业务</td><td class="confluenceTd">填写该故障影响了哪些业务（如：钱包，糯米）</td></tr><tr><td class="confluenceTd">造成故障的服务</td><td class="confluenceTd">填写哪个服务造成了该次故障（如：钱包）</td></tr><tr><td colspan="1" class="confluenceTd">故障持续时间</td><td colspan="1" class="confluenceTd">填写故障从发生到止损完成总耗费的时间</td></tr><tr><td colspan="1" class="confluenceTd">自我恢复</td><td colspan="1" class="confluenceTd">填写是或否</td></tr></tbody></table>

## case 详细信息
<table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p align="left"><strong>【故障概要描述】</strong></p></td><td colspan="3" class="confluenceTd"><p align="left">对故障进行概要描述，写清楚何时何系统因何原因发生什么故障，总体影响是什么（PV有损，服务拒绝还是功能错误？）</p></td></tr><tr><td class="confluenceTd"><p align="left"><strong>【故障关键时间点】</strong></p></td><td colspan="3" class="confluenceTd"><p align="left">请按如下格式描述：</p><p align="left">1，故障发生时间：yyyy-mm-dd hh24:mi</p><p align="left">2，故障感知时间：yyyy-mm-dd hh24:mi</p><p align="left">3，止损完成时间：yyyy-mm-dd hh24:mi</p></td></tr><tr><td class="confluenceTd"><p align="left"><strong>【故障影响和损失】</strong></p></td><td colspan="3" class="confluenceTd"><p align="left">详细描述故障对业务造成的影响以及具体的损失数据，格式：<br> 1，故障影响范围及程度说明<br> 2，损失量情况<br> 损失数据包括：流量损失、收入损失、流水损失、损失占当天的比例。</p></td></tr><tr><td class="confluenceTd"><p align="left"><strong>【故障原因分析】</strong></p></td><td colspan="3" class="confluenceTd"><p align="left">描述故障根本原因，以及此原因导致故障发生的逻辑。如录入case时，故障根本原因未定位，可后续补录。如最终故障根本原因未定位，可填写原因未明。</p></td></tr><tr><td rowspan="7" class="confluenceTd"><p align="left"><strong>【故障过程详情&amp;问题&amp;改进】</strong></p></td><td class="confluenceTd"><p align="center"><strong>现象&amp;处理</strong></p></td><td class="confluenceTd"><p align="center"><strong>暴露的问题</strong></p></td><td class="confluenceTd"><p align="center"><strong>改进措施</strong></p></td></tr><tr><td class="confluenceTd"><p align="left"><strong>以时间顺序详细描述故障发生（诱发）、发展（扩散、隔离）、发现（监控、测试）、处理（止损）过程及其间系统的表现，重点关注诱发原因、扩散条件、止损动作、止损效果等关键要素，每句以时间开头，每个关键节点单独写一行。下面以历史case给出了示例：</strong></p></td><td class="confluenceTd"><p align="left"><strong>描述对应“现象&amp;处理”中暴露出来的问题，包括技术、流程、意识方面的问题。下面以历史case给出了示例：</strong></p></td><td class="confluenceTd"><p align="left"><strong>针对暴露的问题，提出具体改进措施，每条措施需要包含五方面内容：针对的问题、措施具体内容、负责人、完成时间、措施落地效果计划如何验证或措施落地产出物。下面以历史case给出了示例：</strong></p></td></tr><tr><td class="confluenceTd"><p align="left">2015年9月23日 13:27 BFE公共集群上线劫持统计功能，开始在所有机房进行单机发布回归，流量较小，监控无感知。<br> 14:36 BFE单机房上线发布回归，此机房无糯米服务，糯米不受影响。</p></td><td class="confluenceTd"><p align="left"><strong>问题1</strong>：BFE和业务之间缺少联动信息通报。<br> <strong>问题2</strong>：公共集群分级发布未能覆盖其所有核心业务。</p></td><td class="confluenceTd"><p align="left"><strong>改进措施1</strong>：针对问题1，短期内强化BFE和业务之间的联动信息通报，BFE变更操作通知各个业务线，糯米关键指标变化通知BFE。***负责，****时间内完成，产出物：BFE和各业务条线信息通报机制文档。<br><strong>改进措施2</strong>： 针对问题2，BFE分级发布的流程优化，关注重点产品线的业务部署，定制分级发布策略。***负责，****时间内完成，产出物：BFE分级发布流程优化方案。</p></td></tr><tr><td class="confluenceTd"><p align="left">15:37 BFE所有机房全量上线。<br> 15:40 全量上线完成，糯米服务开始受到影响。</p></td><td class="confluenceTd"><p align="left"><strong>问题3</strong>：BFE上线有bug，测试阶段未发现。</p></td><td class="confluenceTd"><p align="left"><strong>改进措施3</strong>：针对问题3，强化测试环节，后续BFE协议相关的修改，都要联合业务线，针对核心做功能性case回归。***负责，****时间内完成。产出物：BFE与业务线功能性回归测试方案<br> <strong>改进措施4</strong>：针对问题3，BFE添加关键产品的业务指标，变更期间时时关注指标变化。***负责，****时间内完成，通过查看BFE关键产品业务指标及变化验证。</p></td></tr><tr><td class="confluenceTd"><p align="left">15:55 糯米业务波动监控预警发出，糯米运维和研发团队开始排查问题。<br> 16:22 确认BFE有上线。</p></td><td class="confluenceTd"><p align="left"><strong>问题4</strong>：端上的服务质量检测能力不足：缺少快速定位手段</p></td><td class="confluenceTd"><p align="left"><strong>改进措施5</strong>：针对问题4，补充app端的监控，建设端上的可用性数据指标和异常判断能力。***负责，****时间内完成。通过展示app端的监控效果验证。</p><p align="left"><strong>改进措施6</strong>：针对问题4，继续推动完成糯米依赖和自身服务变更数据的汇总，与糯米业务监控omon系统联动，提升故障定位效率。***负责，****时间内完成。通过展示与omon系统联动效果进行验证。</p></td></tr><tr><td class="confluenceTd"><p align="left">16:29 完成BFE配置回滚，同时糯米业务完成BFE故障预案(绕过BFE)，服务开始恢复。<br> 16:31 服务全面恢复。</p></td><td class="confluenceTd"><p align="left">无</p></td><td class="confluenceTd"><p align="left">无</p></td></tr><tr><td class="confluenceTd">&nbsp;</td><td class="confluenceTd">&nbsp;</td><td class="confluenceTd">&nbsp;</td></tr><tr><td class="confluenceTd"><p align="left"><strong>【事故责任认定】</strong></p></td><td colspan="3" class="confluenceTd"><p align="left">描述最终决定的事故责任认定情况</p></td></tr><tr><td colspan="1" class="confluenceTd"><p><strong>【标准问题checklist</strong><strong style="line-height: 1.42857;">】</strong></p></td><td colspan="3" class="confluenceTd"><p>下面是一些标准问题。如果在原因分析/改进措施中已经处理，请写上改进措施序号。对于没有处理的，说明为什么不需要处理。</p><ol><li>为什么会发生这个问题？design、coding、操作？</li><li>为什么测试阶段没有发现?</li><li>系统为什么不能容错？</li><li>能不能更早发现问题？</li><li>解决过程能否更快？</li><li>怎么防止类似的事情发生？</li></ol></td></tr></tbody></table>

## 模板2

<table class="confluenceTable"><tbody><tr><th class="confluenceTh">报告时间</th><th class="confluenceTh">2016-06-29</th></tr><tr><td class="confluenceTd">报告状态</td><td class="confluenceTd"><p>in process</p></td></tr><tr><td class="confluenceTd">相关人员</td><td class="confluenceTd"><p>讨论：</p><p>撰写：</p><p>审核：</p><p>发布：</p><p>改进负责人：</p><p>审核确认关闭：</p></td></tr><tr><td class="confluenceTd"><pre>iCafe单号</pre></td><td class="confluenceTd">无</td></tr><tr><td colspan="1" class="confluenceTd">故障级别</td><td colspan="1" class="confluenceTd"><p>待定</p></td></tr><tr><td colspan="1" class="confluenceTd">故障简述</td><td colspan="1" class="confluenceTd"><p class="p1">&nbsp;</p></td></tr><tr><td colspan="1" class="confluenceTd">故障时间</td><td colspan="1" class="confluenceTd"><p>故障发生时间：2016-06-28 23:15</p><p>故障发现时间：2016-06-28 23:19</p><p>止损操作开始时间：2016-06-28 23:19</p><p>止损操作完成时间：2016-06-28 23:19</p><p>止损生效完成时间：2016-06-28 23:19</p><p>服务完全恢复时间：2016-06-28 23:40</p><p><strong>故障持续时长：14分钟</strong></p></td></tr><tr><td colspan="1" class="confluenceTd">故障影响</td><td colspan="1" class="confluenceTd"><p>影响简述：</p><p>是否有流水损失：</p><p>损失类型（流量丢失/服务拒绝/流水损失/功能缺失）：</p><p>pv 损失及当日占比：</p><p>流水损失及日占比：</p><p>故障范围：</p></td></tr><tr><td colspan="1" class="confluenceTd">故障原因</td><td colspan="1" class="confluenceTd"><p>主要原因：</p><p>触发原因：表结构变更引起DB主从同步延时</p></td></tr><tr><td colspan="1" class="confluenceTd">故障发现</td><td colspan="1" class="confluenceTd"><p>类型：电话报警/短信报警/人工发现</p><p>报警事件：</p></td></tr><tr><td colspan="1" class="confluenceTd">故障处理手段</td><td colspan="1" class="confluenceTd">类型：流量调度/回滚上线单/重启服务/服务降级/流量限制/容量扩容/摘除异常/主从切换（单项目或多项目组合）</td></tr><tr><td colspan="1" class="confluenceTd">故障类型</td><td colspan="1" class="confluenceTd">变更故障/程序 bug/网络攻击/内部第三方/外部第三方/网络故障/其他故障</td></tr><tr><td colspan="1" class="confluenceTd">分级发布是否拦截成功</td><td colspan="1" class="confluenceTd">不涉及</td></tr><tr><td colspan="1" class="confluenceTd">改进措施</td><td colspan="1" class="confluenceTd"><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><pre>改进Checklist问题</pre></th><th class="confluenceTh">暴露的问题</th><th class="confluenceTh">改进措施</th><th colspan="1" class="confluenceTh">负责人</th><th colspan="1" class="confluenceTh">当前状态</th><th colspan="1" class="confluenceTh">预期完成时间</th></tr><tr><td class="confluenceTd">Design: 程序/系统设计上能否容错？</td><td class="confluenceTd">&nbsp;</td><td class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd"><p class="_mce_tagged_br">1</p></td>
<td colspan="1" class="confluenceTd"><p>&nbsp;</p></td><td colspan="1" class="confluenceTd"><p>1</p></td></tr><tr><td colspan="1" class="confluenceTd">Code: 程序实现上能否拦截？</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td></tr><tr><td colspan="1" class="confluenceTd">Test：测试能否拦截？</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td></tr><tr><td colspan="1" class="confluenceTd"><p>Deploy：发布过程能否拦截？</p><p>Deploy：部署架构是否单机房独立？</p></td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td></tr><tr><td colspan="1" class="confluenceTd">Operate：操作如何出问题的？</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td></tr><tr><td colspan="1" class="confluenceTd">Detect：是否第一时间发现问题？</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd"><p>1.</p></td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd"><p><span style="color: rgb(0,51,102);">1.</span></p></td></tr><tr><td colspan="1" class="confluenceTd">Recover：能不能更快一些止损和恢复？</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd"><p>1.</p></td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td></tr><tr><td colspan="1" class="confluenceTd">workflow：流程上？</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">1.</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd"><span style="color: rgb(0,51,102);">1.</span></td></tr><tr><td colspan="1" class="confluenceTd">Capacity：容量上？</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td></tr><tr><td colspan="1" class="confluenceTd">Third Party Systems ：第三方依赖？(如BFE、数据库、ORCP平台等)</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td></tr><tr><td colspan="1" class="confluenceTd">Hardware：硬件上？</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td></tr><tr><td colspan="1" class="confluenceTd">Network： 数据中心网络设备上？</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td></tr><tr><td colspan="1" class="confluenceTd">Config ： 配置管理上有没有问题？</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td></tr><tr><td colspan="1" class="confluenceTd">Other：有没有共性问题，其他产品线需要注意</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd"><p>1.</p></td><td colspan="1" class="confluenceTd">&nbsp;</td><td colspan="1" class="confluenceTd"><p>1.</p></td></tr></tbody></table></div></td></tr><tr><td colspan="1" class="confluenceTd">Lessons Learned</td><td colspan="1" class="confluenceTd"><p>好的方面</p><ol><li style="list-style-type: none;background-image: none;"><ol><li>-</li></ol></li></ol><p>不好的方面</p><ol><li style="list-style-type: none;background-image: none;"><ol><li>-</li></ol></li></ol><p>我们有哪些运气成分？</p><ol><li style="list-style-type: none;background-image: none;"><ol><li>-</li></ol></li></ol></td></tr><tr><td colspan="1" class="confluenceTd">时间线Timeline</td><td colspan="1" class="confluenceTd"><p>(all times 北京时间)</p><ul><li>2016-06-28 23:07 <span style="color: rgb(255,0,0);"><strong>【<span style="color: rgb(255,0,0);"><strong>问题引入</strong></span>】</strong></span>：</li><li>2016-06-28 23:15 <span style="color: rgb(255,0,0);"><strong>【<span style="color: rgb(255,0,0);"><strong>故障发生</strong></span>】</strong></span>：</li><li>2016-06-28 23:19 <span style="color: rgb(255,0,0);"><strong>【<span style="color: rgb(255,0,0);"><strong>故障发现</strong></span>】</strong></span>：</li><li>2016-06-28&nbsp;23:19 <span style="color: rgb(255,0,0);"><strong>【<span style="color: rgb(255,0,0);"><strong>开始止损</strong></span>】</strong></span>：</li><li>2016-06-28&nbsp;23:23<span style="color: rgb(255,0,0);"> <span style="color: rgb(0,0,0);"><span style="color: rgb(255,0,0);"><strong>【<span style="color: rgb(255,0,0);"><span style="color: rgb(0,0,0);"><span style="color: rgb(255,0,0);"><strong>止损完成</strong></span></span></span>】</strong></span>：</span></span></li><li>2016-06-28 23:28 <span style="color: rgb(255,0,0);"><strong>【<span style="color: rgb(255,0,0);"><strong>服务恢复常态</strong></span>】</strong></span>：</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">支撑信息</td><td colspan="1" class="confluenceTd"><p>（包括但不限于监控趋势图/报警信息/人工反馈信息等）</p><p>&nbsp;</p></td></tr><tr><td colspan="1" class="confluenceTd">case 关注点</td><td colspan="1" class="confluenceTd"><p>Why？为什么会发生这个问题？</p><p>&nbsp;</p><p> Why？为什么测试阶段没有发现?</p><p>&nbsp;</p><p>Why？为什么系统不能容错？</p><p>&nbsp;</p><p>Can？能不能更早发现问题？</p><p>&nbsp;</p><p>Can？解决过程能不能更快？</p><p>&nbsp;</p><p>How？怎么防止类似的事情发生？</p><p>&nbsp;</p></td></tr></tbody></table>
